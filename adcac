local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")

local BoothSniper = {}

-- Real-time item price database
BoothSniper.ItemPrices = {
  ["Huge Pet"] = {
    currentMarketPrice = 0,
    lastUpdated = 0,
    priceHistory = {}
  },
  ["Mythic Pet"] = {
    currentMarketPrice = 0,
    lastUpdated = 0,
    priceHistory = {}
  },
  ["Legendary Pet"] = {
    currentMarketPrice = 0, 
    lastUpdated = 0,
    priceHistory = {}
  }
}

-- Configuration with dynamic price tracking
BoothSniper.Config = {
  DiscordWebhook = "",
  MinGems = 1000000,
  MaxSpendGems = 5000000,
  AutoBuy = true,
  SniperEnabled = true,
  UserPriceTargets = {
    ["Huge Pet"] = {
      minPrice = 3000000,
      maxPrice = 6000000
    },
    ["Mythic Pet"] = {
      minPrice = 2000000,
      maxPrice = 4000000
    }
  }
}

-- Function to update real-time market prices
function BoothSniper:UpdateMarketPrices()
  -- Simulate market price tracking
  -- In a real implementation, this would connect to an actual price API
  for itemType, data in pairs(self.ItemPrices) do
    local simulatedPrice = math.random(1000000, 10000000)
    
    data.currentMarketPrice = simulatedPrice
    data.lastUpdated = tick()
    
    table.insert(data.priceHistory, simulatedPrice)
    
    -- Keep only last 10 price points
    if #data.priceHistory > 10 then
      table.remove(data.priceHistory, 1)
    end
  end
end

-- Function to check if item meets user's price criteria
function BoothSniper:MeetsPriceTarget(itemType, price)
  local target = self.Config.UserPriceTargets[itemType]
  
  if not target then return false end
  
  return price >= target.minPrice and price <= target.maxPrice
end

-- Advanced booth scanning with price tracking
function BoothSniper:CheckBoothItems()
  self:UpdateMarketPrices()  -- Update prices before scanning
  
  local booths = game:GetService("Workspace").Booths
  
  for _, booth in pairs(booths:GetChildren()) do
    local items = booth:FindFirstChild("Items")
    
    if items then
      for _, item in pairs(items:GetChildren()) do
        local price = item:GetAttribute("Price")
        local itemType = item.Name
        
        -- Check if item meets buying criteria
        if self:MeetsPriceTarget(itemType, price) then
          self:BuyItem(item)
          self:SendDiscordNotification(item, price)
        end
      end
    end
  end
end

-- Discord notification with market price context
function BoothSniper:SendDiscordNotification(item, price)
  local marketPrice = self.ItemPrices[item.Name].currentMarketPrice
  local message = string.format(
    "Bought %s for %d gems (Market Price: %d gems)",
    item.Name, price, marketPrice
  )
  
  -- Implement Discord webhook logic here
end

return BoothSniper
